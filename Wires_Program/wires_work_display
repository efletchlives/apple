#include <Wire.h>
#include "ADS1X15.h"
#include "Voltage_Value.h"
#include <Adafruit_SSD1306.h>

#define OLED_RESET 4
Adafruit_SSD1306 Display1(OLED_RESET);
Adafruit_SSD1306 Display2(OLED_RESET);

ADS1115 ADS(0x48);

RangedInt WIRE_RED(14000, 15700, 14800); // on breadboard: BLACK
RangedInt WIRE_GREEN(11500, 12500, 12000); // on breadboard: GREEN
RangedInt WIRE_BLACK(17000, 18000, 17500); // on breadboard: YELLOW
RangedInt expected_value;

// Track which wires and pins have been used
bool wireUsed[3] = {false, false, false};  // RED, GREEN, BLACK
bool pinUsed[3] = {false, false, false};   // A0, A1, A2

int currentWire = -1;  // Which wire to place next
int currentPin = -1;   // Which pin to place it in

int counter = 0;

void setup()   {

  Serial.begin(9600);
//Display Code
  Display1.begin(SSD1306_SWITCHCAPVCC, 0x3C);
  Display1.clearDisplay();
  Display1.display();

  Display2.begin(SSD1306_SWITCHCAPVCC, 0x3D);
  Display2.clearDisplay();
  Display2.display();
//Wire code
  Wire.begin();
  ADS.begin();
  ADS.setGain(0);
  ADS.setDataRate(7);
  ADS.setMode(1);
  randomSeed(analogRead(0));
  pickNextWireAndPin();  //Function created to make sure we are not using the same wires over and over again
  
}


void pickNextWireAndPin()
{
  do{
    currentWire = random(0,3); //Picking one of the random 3 wires
  } 
  while (wireUsed[currentWire]); //Pick a random wire while the wireUsed remains false
  wireUsed[currentWire] = true; //Set thes wire we used to true so we know not to use it again

  do{
    currentPin = random(0,3); //Picking one of the random 3 pins
  }
  while(pinUsed[currentPin]); //Picking a random pin while the pinUsed remains false
  pinUsed[currentPin] = true; //Sets the pin we used to true to we know not to use it again

  if(currentWire == 0)
  {
    Serial.print("Connect the Black Wire to pin A");
    Serial.print(currentPin);
  }
  else if(currentWire == 1)
  {
    Serial.print("Connect the Green Wire to Pin A");
    Serial.print(currentPin);
  }
  else
  {
    Serial.print("Connect to the Red Wire to Pin A");
    Serial.print(currentPin);
  }
}
void loop() {
  
    int reading = ADS.readADC(currentPin);

    //Picking the corresponding value to the respective wire
    if(currentWire == 0)
    {
       expected_value = WIRE_BLACK;
    }
    else if(currentWire == 1)
    {
      expected_value = WIRE_GREEN;
    }
    else 
    {
       expected_value = WIRE_RED;
    }


    if(expected_value.isInRange(reading))
    {
      Serial.println("HOLY SHIT YOU GOT IT RIGHT");

      if(wireUsed[0] && wireUsed[1] && wireUsed[2])
      {
        Serial.println("U DONE BOI");
        counter++;
         Display2.clearDisplay();
         Display2.setTextSize(2);
         Display2.setTextColor(WHITE, BLACK);
        Display2.setCursor(0, 0);
        Display2.println(counter);
         Display2.display();
         
         for(int i = 0 ; i < 3 ; i++)
         {
          wireUsed[i] = false;
          pinUsed[i] = false;
         }

         Serial.println("START A NEW ROUND WOOOOO");

         pickNextWireAndPin();
      }
      else
      {
        delay(1000);
        pickNextWireAndPin();
      }
    }
    else{
      
      delay(1000);
    } 
    Display1.clearDisplay();
    Display1.setTextSize(1);
    Display1.setTextColor(WHITE, BLACK);
    Display1.setCursor(0, 0 );
    Display1.println("Connect the wires");
    Display1.display();

}
